<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> - –©—É—Ä–æ–ø–µ–¥–∏—è</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <header>
        <h1><a href="/">–©—É—Ä–æ–ø–µ–¥–∏—è</a></h1>
        <div class="auth-links">
            <% if (user) { %>
                <span>–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: <strong><%= user %></strong></span>
                <form method="POST" action="/logout" style="display: inline;">
                    <button type="submit">–í—ã–π—Ç–∏</button>
                </form>
                <a href="/create">–°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—å—é</a>
            <% } else { %>
                <a href="/admin">üîê –í—Ö–æ–¥ –∞–¥–º–∏–Ω–∞</a>
            <% } %>
        </div>
    </header>
    <main>
        <div class="content">
            <h1><%= title %></h1>
            <div>
                <%- content %>
            </div>
            
            <% if (user && article) { %>
                <div style="margin-top: 20px;">
                    <a href="/edit/<%= title %>">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a> | 
                    <a href="/history/<%= title %>">–ò—Å—Ç–æ—Ä–∏—è</a> | 
                    <a href="/create">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é</a>
                </div>
            <% } %>
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å—Ç–∞—Ç—å—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç) -->
        <% if (user && article) { %>
        <div class="article-actions">
            <a href="/edit/<%= title %>" class="action-btn primary">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
            <a href="/history/<%= title %>" class="action-btn">üìú –ò—Å—Ç–æ—Ä–∏—è</a>
            <button class="action-btn favorite-btn" onclick="toggleFavorite(<%= article.id %>)">‚≠ê –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
        </div>
        <% } %>

        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å—Ç–∞—Ç—å—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç) -->
        <% if (article) { %>
        <div class="reading-progress" style="margin: 1rem 0 2rem 0;">
            <div class="progress-bar" id="progressBar" style="height: 6px; background: #e0e0e0; border-radius: 3px; overflow: hidden;">
                <div id="progressFill" style="height: 100%; width: 0%; background: linear-gradient(90deg, #36c, #2a5); transition: width 0.3s;"></div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.9rem; color: #666;">
                <span id="progressText">0% –ø—Ä–æ—á–∏—Ç–∞–Ω–æ</span>
                <span id="readingTime">–ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è —á—Ç–µ–Ω–∏—è: <span id="timeValue">2 –º–∏–Ω</span></span>
            </div>
        </div>
        <% } %>

        <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å—Ç–∞—Ç—å—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç) -->
        <% if (article) { %>
        <div class="comments-section">
            <h3>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
            
            <% if (user) { %>
                <form method="POST" action="/comment/<%= article.id %>" class="comment-form">
                    <input type="hidden" name="articleTitle" value="<%= title %>">
                    <textarea name="content" placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required></textarea>
                    <button type="submit" class="action-btn primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </form>
            <% } %>
            
            <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
        </div>
        <% } %>
    </main>

    <script>
    // –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —á—Ç–µ–Ω–∏—è —Å—Ç–∞—Ç—å–∏ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —Å—Ç–∞—Ç—å—è)
    document.addEventListener('DOMContentLoaded', function() {
        const articleContent = document.querySelector('.content');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const timeValue = document.getElementById('timeValue');
        
        // –ï—Å–ª–∏ –Ω–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ –∏–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ - –≤—ã—Ö–æ–¥–∏–º
        if (!progressFill || !articleContent) return;
        
        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—Ä–µ–º—è —á—Ç–µ–Ω–∏—è
        const text = articleContent.textContent || articleContent.innerText;
        const wordCount = text.split(/\s+/).length;
        const readingTimeMinutes = Math.ceil(wordCount / 200);
        if (timeValue) timeValue.textContent = `${readingTimeMinutes} –º–∏–Ω`;
        
        function updateProgress() {
            const articleHeight = articleContent.offsetHeight;
            const windowHeight = window.innerHeight;
            const scrollPosition = window.scrollY;
            const windowBottom = scrollPosition + windowHeight;
            
            const articleTop = articleContent.offsetTop;
            const articleBottom = articleTop + articleHeight;
            
            let visibleHeight = 0;
            
            if (scrollPosition <= articleTop) {
                visibleHeight = 0;
            } else if (windowBottom >= articleBottom) {
                visibleHeight = articleHeight;
            } else {
                visibleHeight = windowBottom - articleTop;
            }
            
            const progress = Math.min(100, Math.max(0, (visibleHeight / articleHeight) * 100));
            
            progressFill.style.width = progress + '%';
            if (progressText) progressText.textContent = Math.round(progress) + '% –ø—Ä–æ—á–∏—Ç–∞–Ω–æ';
            
            if (progress >= 100) {
                progressFill.style.background = 'linear-gradient(90deg, #28a745, #20c997)';
            } else {
                progressFill.style.background = 'linear-gradient(90deg, #36c, #2a5)';
            }
        }
        
        window.addEventListener('scroll', updateProgress);
        window.addEventListener('resize', updateProgress);
        updateProgress();
    });
    </script>
</body>
</html>
